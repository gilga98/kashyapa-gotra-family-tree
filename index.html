<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vamsha Vruksha ‚Äì Family Tree</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --glass-bg: rgba(15, 23, 42, 0.65);
      --glass-border: rgba(148, 163, 184, 0.2);
      --highlight: rgba(129, 140, 248, 0.15);
      --accent: #818cf8;
      --text-main: #e2e8f0;
      --text-dim: #94a3b8;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: radial-gradient(circle at top right, #1e1b4b 0%, #0f172a 100%);
      color: var(--text-main);
      height: 100vh;
      overflow: hidden;
    }

    /* Layout */
    .app-container {
      display: grid;
      grid-template-columns: 350px 1fr;
      height: 100%;
      max-width: 1600px;
      margin: 0 auto;
    }

    /* Sidebar / Search List */
    .sidebar {
      background: rgba(15, 23, 42, 0.8);
      border-right: 1px solid var(--glass-border);
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(12px);
    }

    .search-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--glass-border);
    }

    h1 { margin: 0 0 1rem; font-size: 1.25rem; letter-spacing: -0.02em; }

    .search-box {
      width: 100%;
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--glass-border);
      padding: 0.75rem 1rem;
      border-radius: 12px;
      color: white;
      outline: none;
      font-size: 0.95rem;
      transition: border-color 0.2s;
      box-sizing: border-box;
    }
    .search-box:focus { border-color: var(--accent); }

    .filter-row {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    select, button.reset {
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--glass-border);
      color: var(--text-dim);
      padding: 0.4rem 0.8rem;
      border-radius: 8px;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .list-view {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    /* Person List Item */
    .list-item {
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
    }
    .list-item:hover { background: rgba(255,255,255,0.03); }
    .list-item.active {
      background: var(--highlight);
      border-color: var(--accent);
    }

    .item-name { font-weight: 600; font-size: 1rem; display: flex; justify-content: space-between; }
    .item-meta { font-size: 0.8rem; color: var(--text-dim); margin-top: 0.25rem; display: flex; align-items: center; gap: 0.5rem; }
    .gen-tag { background: rgba(255,255,255,0.1); padding: 1px 6px; border-radius: 4px; font-size: 0.7rem; }

    /* Main Detail View */
    .main-view {
      padding: 2rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Hierarchy Visuals */
    .lineage-node {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 800px;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Parents Section */
    .parents-row {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      position: relative;
    }
    .parents-row::after {
      content: ''; position: absolute; bottom: -2rem; left: 50%;
      width: 2px; height: 2rem; background: var(--glass-border);
    }

    .mini-card {
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--glass-border);
      padding: 0.5rem 1rem;
      border-radius: 99px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: 0.2s;
    }
    .mini-card:hover { border-color: var(--accent); color: var(--accent); }

    /* The Couple Card (Focus) */
    .couple-container {
      background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
      border: 1px solid rgba(129, 140, 248, 0.3);
      padding: 2rem;
      border-radius: 24px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      gap: 2rem;
      position: relative;
      margin-bottom: 3rem;
      backdrop-filter: blur(20px);
    }
    
    .couple-container::after {
      content: ''; position: absolute; bottom: -3rem; left: 50%;
      width: 2px; height: 3rem; background: var(--glass-border);
    }

    .person-focus { text-align: center; }
    .focus-name { font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 0.25rem; }
    .focus-meta { font-size: 0.9rem; color: var(--accent); text-transform: uppercase; letter-spacing: 0.05em; }
    
    .spouse-connector {
      display: flex; flex-direction: column; align-items: center; color: #f472b6; font-size: 1.5rem; opacity: 0.8;
    }
    .spouse-label { font-size: 0.7rem; margin-top: -5px; color: var(--text-dim); }

    /* Children Section */
    .children-tree {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      position: relative;
      padding-top: 1rem;
      border-top: 2px solid var(--glass-border);
    }
    
    .child-card {
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--glass-border);
      padding: 1rem 1.5rem;
      border-radius: 16px;
      text-align: center;
      cursor: pointer;
      min-width: 140px;
      position: relative;
      transition: 0.2s;
    }
    .child-card:hover { transform: translateY(-5px); background: rgba(255,255,255,0.08); }
    .child-card::before {
      content: ''; position: absolute; top: -1.1rem; left: 50%;
      width: 2px; height: 1.1rem; background: var(--glass-border);
    }
    
    .child-name { font-weight: 600; font-size: 1rem; }
    .child-gender { font-size: 0.8rem; margin-top: 0.25rem; opacity: 0.7; }
    
    .gender-m { color: #60a5fa; }
    .gender-f { color: #f472b6; }

    .empty-state {
      height: 100%; display: flex; align-items: center; justify-content: center;
      color: var(--text-dim); font-size: 1.1rem;
    }

    /* Mobile */
    @media (max-width: 768px) {
      .app-container { grid-template-columns: 1fr; }
      .sidebar { display: flex; }
      .main-view { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0f172a; z-index: 10; }
      .main-view.active { display: flex; }
      
      .couple-container { flex-direction: column; gap: 1rem; padding: 1.5rem; width: 90%; }
      .parents-row::after { height: 1.5rem; bottom: -1.5rem; }
      .couple-container::after { height: 2rem; bottom: -2rem; }
      
      .back-btn {
        display: block; position: absolute; top: 1rem; left: 1rem;
        padding: 0.5rem 1rem; background: rgba(255,255,255,0.1); border-radius: 8px; border: none; color: white;
      }
    }
    .back-btn { display: none; }

  </style>
</head>
<body>

<div class="app-container">
  <!-- Left Sidebar: Search & List -->
  <aside class="sidebar">
    <div class="search-header">
      <h1>Vamsha Vruksha</h1>
      <input type="text" id="searchInput" class="search-box" placeholder="Search family members..." />
      <div class="filter-row">
        <select id="genFilter">
          <option value="all">All Generations</option>
          <option value="1-5">Gen 1 - 5 (Ancestors)</option>
          <option value="6-9">Gen 6 - 9 (Mid)</option>
          <option value="10-15">Gen 10+ (Current)</option>
        </select>
        <button class="reset" onclick="resetFilters()">Reset</button>
      </div>
    </div>
    <div id="personList" class="list-view">
      <!-- Generated Items -->
    </div>
  </aside>

  <!-- Right Main: Detail View -->
  <main id="mainView" class="main-view">
    <button class="back-btn" onclick="closeDetail()">‚Üê Back to List</button>
    <div id="detailContent" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
      <div class="empty-state">Select a family member to view their lineage</div>
    </div>
  </main>
</div>

<script>
  let familyData = {};
  let personsArray = [];

  // Load JSON
  fetch('family-tree.json')
    .then(res => res.json())
    .then(data => {
      familyData = data.persons;
      personsArray = Object.values(familyData).sort((a, b) => a.generation - b.generation);
      renderList(personsArray);
    })
    .catch(err => console.error("Error loading JSON. Make sure family-tree.json is in the same folder.", err));

  // --- Render List with Disambiguation ---
  function renderList(list) {
    const container = document.getElementById('personList');
    container.innerHTML = '';
    
    list.forEach(p => {
      const el = document.createElement('div');
      el.className = 'list-item';
      el.onclick = () => loadPerson(p.id);
      
      // Resolve Parent Name for Context
      let parentContext = "";
      if (p.parents && p.parents.length > 0) {
        const parentName = familyData[p.parents[0]]?.name || "Unknown";
        parentContext = ` ‚Ä¢ ${p.gender === 'F' ? 'd/o' : 's/o'} ${parentName}`;
      }

      el.innerHTML = `
        <div class="item-name">
          ${p.name}
          ${p.spouse ? '<span style="font-size:0.8em; opacity:0.6">üíç</span>' : ''}
        </div>
        <div class="item-meta">
          <span class="gen-tag">Gen ${p.generation}</span>
          <span>${parentContext}</span>
        </div>
      `;
      container.appendChild(el);
    });
  }

  // --- Filter Logic ---
  const searchInput = document.getElementById('searchInput');
  const genFilter = document.getElementById('genFilter');

  function filterData() {
    const term = searchInput.value.toLowerCase();
    const genVal = genFilter.value;
    
    const filtered = personsArray.filter(p => {
      const matchesSearch = p.name.toLowerCase().includes(term);
      let matchesGen = true;
      if (genVal === '1-5') matchesGen = p.generation <= 5;
      if (genVal === '6-9') matchesGen = p.generation >= 6 && p.generation <= 9;
      if (genVal === '10-15') matchesGen = p.generation >= 10;
      
      return matchesSearch && matchesGen;
    });
    renderList(filtered);
  }

  searchInput.addEventListener('input', filterData);
  genFilter.addEventListener('change', filterData);

  function resetFilters() {
    searchInput.value = '';
    genFilter.value = 'all';
    renderList(personsArray);
  }

  // --- Detail View Renderer ---
  function loadPerson(id) {
    const p = familyData[id];
    if (!p) return;

    // Mobile Toggle
    document.getElementById('mainView').classList.add('active');

    // Highlight in list
    document.querySelectorAll('.list-item').forEach(el => el.classList.remove('active'));
    // (Optional: scroll list to item logic here)

    const content = document.getElementById('detailContent');
    
    // 1. Parents HTML
    let parentsHtml = '';
    if (p.parents && p.parents.length > 0) {
      parentsHtml = `<div class="parents-row">`;
      p.parents.forEach(pid => {
        const parent = familyData[pid];
        if(parent) {
          parentsHtml += `<div class="mini-card" onclick="loadPerson('${pid}')">‚Üë ${parent.name}</div>`;
        }
      });
      parentsHtml += `</div>`;
    } else {
      parentsHtml = `<div class="parents-row"><div class="mini-card" style="opacity:0.5; cursor:default">Root Ancestor</div></div>`;
    }

    // 2. Spouse Logic
    let spouseHtml = '';
    if (p.spouse && familyData[p.spouse]) {
      const spouse = familyData[p.spouse];
      spouseHtml = `
        <div class="spouse-connector">
          <span>‚ô•</span>
        </div>
        <div class="person-focus" style="cursor:pointer" onclick="loadPerson('${spouse.id}')">
          <div class="focus-name">${spouse.name}</div>
          <div class="focus-meta">Spouse</div>
        </div>
      `;
    } else {
      spouseHtml = `<!-- Single -->`;
    }

    // 3. Children HTML
    let childrenHtml = '';
    if (p.children && p.children.length > 0) {
      childrenHtml = `<div class="children-tree">`;
      p.children.forEach(cid => {
        const child = familyData[cid];
        if (child) {
          const genderClass = child.gender === 'M' ? 'gender-m' : 'gender-f';
          const genderIcon = child.gender === 'M' ? '‚ôÇ' : '‚ôÄ';
          childrenHtml += `
            <div class="child-card" onclick="loadPerson('${cid}')">
              <div class="child-name">${child.name}</div>
              <div class="child-gender ${genderClass}">${genderIcon} Gen ${child.generation}</div>
            </div>
          `;
        }
      });
      childrenHtml += `</div>`;
    } else {
      childrenHtml = `<div style="margin-top:2rem; opacity:0.5">No children listed</div>`;
    }

    // Assemble View
    content.innerHTML = `
      <div class="lineage-node">
        ${parentsHtml}
        
        <div class="couple-container">
          <div class="person-focus">
            <div class="focus-name">${p.name}</div>
            <div class="focus-meta">Generation ${p.generation}</div>
          </div>
          ${spouseHtml}
        </div>

        ${childrenHtml}
      </div>
    `;
  }

  function closeDetail() {
    document.getElementById('mainView').classList.remove('active');
  }

</script>
</body>
</html>
